<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê¸°ìˆ  ë¸”ë¡œê·¸</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
<div class="w3-content">
    <nav class="navbar">
        <div class="container">
            <a href="/index.html" class="nav-brand">ğŸš€ MSA Project</a>
            <div class="nav-links">
                <a href="/board/board_list.html" class="nav-link">ê²Œì‹œíŒ</a>
                <a href="/blog/blog_list.html" class="nav-link">ë¸”ë¡œê·¸</a>
            </div>
            <div id="auth-links" class="nav-auth"></div>
                <a href="/blog/post_form.html" class="nav-link w3-button btn-primary" style="margin-right: 10px;">ê¸€ ì‘ì„±</a>
        </div>
    </nav>

    <header class="w3-container w3-center w3-padding-32">
        <h1><b>MY BLOG</b></h1>
        <p>Welcome to the blog of <span class="w3-tag">unknown</span></p>
    </header>

    <main class="container">
        <div id="blog-grid-container" class="grid-container">
            </div>
        <div id="loading-indicator" style="text-align: center; padding: 2rem; display: none;">
            <p>Loading more posts...</p>
        </div>
    </main>
</div>

<script src="/assets/js/auth.js"></script>
<script>
    const gridContainer = document.getElementById('blog-grid-container');
    const loadingIndicator = document.getElementById('loading-indicator');
    
    // --- ë¬´í•œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ìƒíƒœ ë³€ìˆ˜ ---
    let currentPage = 1;
    let isLoading = false; // ì¤‘ë³µ ìš”ì²­ ë°©ì§€ë¥¼ ìœ„í•œ í”Œë˜ê·¸
    let hasMore = true;    // ë” ì´ìƒ ë¶ˆëŸ¬ì˜¬ ë°ì´í„°ê°€ ì—†ëŠ”ì§€ í™•ì¸í•˜ëŠ” í”Œë˜ê·¸
    const POSTS_PER_PAGE = 9;

    async function fetchAndRenderBlog(page) {
        // ì´ë¯¸ ë¡œë”© ì¤‘ì´ê±°ë‚˜ ë” ì´ìƒ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í•¨ìˆ˜ë¥¼ ì¦‰ì‹œ ì¢…ë£Œ
        if (isLoading || !hasMore) return;

        isLoading = true;
        loadingIndicator.style.display = 'block';

        try {
            const response = await fetch(`/api/blog/articles?page=${page}&size=${POSTS_PER_PAGE}`);
            if (!response.ok) throw new Error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨');
            
            const data = await response.json();
            
            if (data.items.length === 0) {
                // ë°›ì•„ì˜¨ ë°ì´í„°ê°€ ì—†ìœ¼ë©´, ë” ì´ìƒ ë¡œë“œí•  ê²Œì‹œë¬¼ì´ ì—†ë‹¤ê³  íŒë‹¨
                hasMore = false;
                loadingIndicator.innerText = "ëª¨ë“  ê¸€ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.";
                return;
            }

            renderArticles(data.items);
            currentPage++; // ë‹¤ìŒ í˜ì´ì§€ë¥¼ ì¤€ë¹„

        } catch (error) {
            loadingIndicator.innerHTML = `<p style="color:red;">${error.message}</p>`;
        } finally {
            isLoading = false;
            // ë¡œë”©ì´ ëë‚˜ë©´ ë¡œë”© í‘œì‹œë¥¼ ìˆ¨ê¸°ì§€ ì•Šê³ , hasMoreê°€ falseì¼ ë•Œë§Œ í…ìŠ¤íŠ¸ ë³€ê²½
            if (!hasMore) {
                loadingIndicator.style.display = 'block';
            } else {
                loadingIndicator.style.display = 'none';
            }
        }
    }

    function renderArticles(articles) {
        // gridContainer.innerHTML = ''; <-- ì´ ì¤„ì„ ì‚­ì œí•˜ì—¬ ê¸°ì¡´ ë‚´ìš©ì„ ìœ ì§€í•©ë‹ˆë‹¤.
        
        articles.forEach(article => {
            const imageUrl = article.image_url || 'https://www.w3schools.com/w3images/woods.jpg';
            const gridItem = `
                <a href="/blog/blog_detail.html?id=${article.id}" class="grid-item">
                    <img src="${imageUrl}" alt="${article.title}">
                    <div class="grid-item-overlay">
                        <span>${article.title}</span>
                    </div>
                </a>
            `;
            gridContainer.insertAdjacentHTML('beforeend', gridItem);
        });
    }

    // --- ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ---
    window.addEventListener('scroll', () => {
        // ì‚¬ìš©ìê°€ í˜ì´ì§€ ë§¨ ì•„ë˜ ê·¼ì²˜ë¡œ ìŠ¤í¬ë¡¤í–ˆëŠ”ì§€ í™•ì¸
        // (ì „ì²´ ë†’ì´ - í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜)ê°€ ë¸Œë¼ìš°ì € ì°½ ë†’ì´ë³´ë‹¤ ì‘ìœ¼ë©´
        if (document.documentElement.scrollHeight - window.scrollY - window.innerHeight < 200) {
            fetchAndRenderBlog(currentPage);
        }
    });

    // í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë“œë  ë•Œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', () => {
        renderNavbar();
        fetchAndRenderBlog(1);
    });
</script>
</body>
</html>