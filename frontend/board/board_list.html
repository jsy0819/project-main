<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ëª©ë¡</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="/assets/js/auth.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/index.html" class="nav-brand">ğŸš€ MSA Project</a>
            <div class="nav-links">
                <a href="/board/board_list.html" class="nav-link">ê²Œì‹œíŒ</a>
                <a href="/blog/blog_list.html" class="nav-link">ë¸”ë¡œê·¸</a>
            </div>
            <div id="auth-links" class="nav-auth"></div>
        </div>
    </nav>

    <main class="container board-page-container"> <h1 class="board-page-title">ê²Œì‹œê¸€ ëª©ë¡</h1>

        <div class="board-action-buttons">
            <a href="/board/board_post.html" class="btn btn-primary">ìƒˆ ê¸€ ì‘ì„±</a>
        </div>

        <div class="table-container">
            <table class="board-list-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ì œëª©</th>
                        <th>ì‘ì„±ì</th>
                        <th>ì¡°íšŒìˆ˜</th>
                        <th>ì‘ì„±ì¼</th>
                    </tr>
                </thead>
                <tbody id="posts-list">
                    </tbody>
            </table>
        </div>

        <div id="no-posts-message" class="board-no-posts" style="display:none;">
            ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ê²Œì‹œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!
        </div>
        <div class="board-pagination">
            <button id="prev-page" class="btn btn-secondary">ì´ì „</button>
            <span id="current-page">1</span>
            <button id="next-page" class="btn btn-secondary">ë‹¤ìŒ</button>
        </div>
    </main>
    
    <script>
        // auth.jsì— ì •ì˜ëœ API_BASE_URLì„ ì‚¬ìš©
        document.addEventListener('DOMContentLoaded', async () => {
            // ë„¤ë¹„ê²Œì´ì…˜ ë°” ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
            await renderNavbar(); 
            
            let currentPage = 1;
            const limit = 10; // í•œ í˜ì´ì§€ì— í‘œì‹œí•  ê²Œì‹œê¸€ ìˆ˜

            const postsList = document.getElementById('posts-list');
            const noPostsMessage = document.getElementById('no-posts-message');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const currentPageSpan = document.getElementById('current-page');

            async function fetchPosts(page) {
                const skip = (page - 1) * limit;
                try {
                    const response = await fetch(`${API_BASE_URL}/api/board/posts/?skip=${skip}&limit=${limit}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const posts = await response.json();
                    
                    postsList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°

                    if (posts.length === 0 && page === 1) {
                        noPostsMessage.style.display = 'block';
                        prevPageBtn.disabled = true;
                        nextPageBtn.disabled = true;
                    } else {
                        noPostsMessage.style.display = 'none';
                        posts.forEach(post => {
                            const row = document.createElement('tr');
                            const createdAt = new Date(post.created_at);
                            const formattedDate = createdAt.toLocaleString('ko-KR', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: false
                            });

                            row.innerHTML = `
                                <td>${post.id}</td>
                                <td><a href="/api/board/posts/${post.id}">${post.title}</a></td>
                                <td>${post.nickname}</td>
                                <td>${post.views}</td>
                                <td>${formattedDate}</td>
                            `;
                            postsList.appendChild(row);
                        });

                        prevPageBtn.disabled = page === 1;
                        const nextResponse = await fetch(`${API_BASE_URL}/api/board/posts/?skip=${page * limit}&limit=1`);
                        const nextPosts = await nextResponse.json();
                        nextPageBtn.disabled = nextPosts.length === 0;
                    }
                    currentPageSpan.textContent = page;

                } catch (error) {
                    console.error('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    postsList.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</td></tr>`;
                    noPostsMessage.style.display = 'none';
                    prevPageBtn.disabled = true;
                    nextPageBtn.disabled = true;
                }
            }

            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    fetchPosts(currentPage);
                }
            });

            nextPageBtn.addEventListener('click', () => {
                currentPage++;
                fetchPosts(currentPage);
            });

            fetchPosts(currentPage); // ì´ˆê¸° ë¡œë“œ
        });
    </script>
</body>
</html>